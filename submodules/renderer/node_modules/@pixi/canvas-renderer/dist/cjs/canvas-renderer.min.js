/*!
 * @pixi/canvas-renderer - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/canvas-renderer is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@pixi/core"),t=require("@pixi/utils"),r=require("@pixi/math"),o=require("@pixi/constants"),n=require("@pixi/settings"),i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},i(e,t)};var a=function(){function e(e){this._foundShapes=[],this.renderer=e}return e.prototype.pushMask=function(e){var t=this.renderer,r=e.maskObject||e;t.context.save();var o=this._foundShapes;if(this.recursiveFindShapes(r,o),o.length>0){var n=t.context;n.beginPath();for(var i=0;i<o.length;i++){var a=o[i],s=a.transform.worldTransform;this.renderer.setContextTransform(s),this.renderGraphicsShape(a)}o.length=0,n.clip()}},e.prototype.recursiveFindShapes=function(e,t){e.geometry&&e.geometry.graphicsData&&t.push(e);var r=e.children;if(r)for(var o=0;o<r.length;o++)this.recursiveFindShapes(r[o],t)},e.prototype.renderGraphicsShape=function(e){e.finishPoly();var t=this.renderer.context,o=e.geometry.graphicsData,n=o.length;if(0!==n)for(var i=0;i<n;i++){var a=o[i],s=a.shape;if(s.type===r.SHAPES.POLY){var h=s.points,l=a.holes,c=void 0,d=void 0,u=void 0,p=void 0;t.moveTo(h[0],h[1]);for(var E=1;E<h.length/2;E++)t.lineTo(h[2*E],h[2*E+1]);if(l.length>0){c=0,u=h[0],p=h[1];for(E=2;E+2<h.length;E+=2)c+=(h[E]-u)*(h[E+3]-p)-(h[E+2]-u)*(h[E+1]-p);for(var g=0;g<l.length;g++)if(h=l[g].shape.points){d=0,u=h[0],p=h[1];for(E=2;E+2<h.length;E+=2)d+=(h[E]-u)*(h[E+3]-p)-(h[E+2]-u)*(h[E+1]-p);if(d*c<0){t.moveTo(h[0],h[1]);for(E=2;E<h.length;E+=2)t.lineTo(h[E],h[E+1])}else{t.moveTo(h[h.length-2],h[h.length-1]);for(E=h.length-4;E>=0;E-=2)t.lineTo(h[E],h[E+1])}l[g].shape.closeStroke&&t.closePath()}}h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&t.closePath()}else if(s.type===r.SHAPES.RECT)t.rect(s.x,s.y,s.width,s.height),t.closePath();else if(s.type===r.SHAPES.CIRC)t.arc(s.x,s.y,s.radius,0,2*Math.PI),t.closePath();else if(s.type===r.SHAPES.ELIP){var D=2*s.width,v=2*s.height,S=s.x-D/2,_=s.y-v/2,f=.5522848,O=D/2*f,M=v/2*f,T=S+D,m=_+v,C=S+D/2,N=_+v/2;t.moveTo(S,N),t.bezierCurveTo(S,N-M,C-O,_,C,_),t.bezierCurveTo(C+O,_,T,N-M,T,N),t.bezierCurveTo(T,N+M,C+O,m,C,m),t.bezierCurveTo(C-O,m,S,N+M,S,N),t.closePath()}else if(s.type===r.SHAPES.RREC){var L=s.x,x=s.y,y=s.width,R=s.height,B=s.radius,b=Math.min(y,R)/2;B=B>b?b:B,t.moveTo(L,x+B),t.lineTo(L,x+R-B),t.quadraticCurveTo(L,x+R,L+B,x+R),t.lineTo(L+y-B,x+R),t.quadraticCurveTo(L+y,x+R,L+y,x+R-B),t.lineTo(L+y,x+B),t.quadraticCurveTo(L+y,x,L+y-B,x),t.lineTo(L+B,x),t.quadraticCurveTo(L,x,L,x+B),t.closePath()}}},e.prototype.popMask=function(e){e.context.restore(),e.invalidateBlendMode()},e.prototype.destroy=function(){},e}();function s(e){var t=n.settings.ADAPTER.createCanvas(6,1),r=t.getContext("2d");return r.fillStyle=e,r.fillRect(0,0,6,1),t}function h(){if("undefined"==typeof document)return!1;var e=s("#ff00ff"),t=s("#ffff00"),r=n.settings.ADAPTER.createCanvas(6,1).getContext("2d");r.globalCompositeOperation="multiply",r.drawImage(e,0,0),r.drawImage(t,2,0);var o=r.getImageData(2,0,1,1);if(!o)return!1;var i=o.data;return 255===i[0]&&0===i[1]&&0===i[2]}var l=new r.Matrix,c=function(r){function s(e){var n,i=r.call(this,o.RENDERER_TYPE.CANVAS,e)||this;if(i.refresh=!0,i.maskManager=new a(i),i.smoothProperty="imageSmoothingEnabled",i.blendModes=(void 0===n&&(n=[]),h()?(n[o.BLEND_MODES.NORMAL]="source-over",n[o.BLEND_MODES.ADD]="lighter",n[o.BLEND_MODES.MULTIPLY]="multiply",n[o.BLEND_MODES.SCREEN]="screen",n[o.BLEND_MODES.OVERLAY]="overlay",n[o.BLEND_MODES.DARKEN]="darken",n[o.BLEND_MODES.LIGHTEN]="lighten",n[o.BLEND_MODES.COLOR_DODGE]="color-dodge",n[o.BLEND_MODES.COLOR_BURN]="color-burn",n[o.BLEND_MODES.HARD_LIGHT]="hard-light",n[o.BLEND_MODES.SOFT_LIGHT]="soft-light",n[o.BLEND_MODES.DIFFERENCE]="difference",n[o.BLEND_MODES.EXCLUSION]="exclusion",n[o.BLEND_MODES.HUE]="hue",n[o.BLEND_MODES.SATURATION]="saturation",n[o.BLEND_MODES.COLOR]="color",n[o.BLEND_MODES.LUMINOSITY]="luminosity"):(n[o.BLEND_MODES.NORMAL]="source-over",n[o.BLEND_MODES.ADD]="lighter",n[o.BLEND_MODES.MULTIPLY]="source-over",n[o.BLEND_MODES.SCREEN]="source-over",n[o.BLEND_MODES.OVERLAY]="source-over",n[o.BLEND_MODES.DARKEN]="source-over",n[o.BLEND_MODES.LIGHTEN]="source-over",n[o.BLEND_MODES.COLOR_DODGE]="source-over",n[o.BLEND_MODES.COLOR_BURN]="source-over",n[o.BLEND_MODES.HARD_LIGHT]="source-over",n[o.BLEND_MODES.SOFT_LIGHT]="source-over",n[o.BLEND_MODES.DIFFERENCE]="source-over",n[o.BLEND_MODES.EXCLUSION]="source-over",n[o.BLEND_MODES.HUE]="source-over",n[o.BLEND_MODES.SATURATION]="source-over",n[o.BLEND_MODES.COLOR]="source-over",n[o.BLEND_MODES.LUMINOSITY]="source-over"),n[o.BLEND_MODES.NORMAL_NPM]=n[o.BLEND_MODES.NORMAL],n[o.BLEND_MODES.ADD_NPM]=n[o.BLEND_MODES.ADD],n[o.BLEND_MODES.SCREEN_NPM]=n[o.BLEND_MODES.SCREEN],n[o.BLEND_MODES.SRC_IN]="source-in",n[o.BLEND_MODES.SRC_OUT]="source-out",n[o.BLEND_MODES.SRC_ATOP]="source-atop",n[o.BLEND_MODES.DST_OVER]="destination-over",n[o.BLEND_MODES.DST_IN]="destination-in",n[o.BLEND_MODES.DST_OUT]="destination-out",n[o.BLEND_MODES.DST_ATOP]="destination-atop",n[o.BLEND_MODES.XOR]="xor",n[o.BLEND_MODES.SUBTRACT]="source-over",n),i.renderingToScreen=!1,i._activeBlendMode=null,i._projTransform=null,i._outerBlend=!1,i.rootContext=i.view.getContext("2d",{alpha:i.useContextAlpha}),i.context=i.rootContext,!i.rootContext.imageSmoothingEnabled){var l=i.rootContext;l.webkitImageSmoothingEnabled?i.smoothProperty="webkitImageSmoothingEnabled":l.mozImageSmoothingEnabled?i.smoothProperty="mozImageSmoothingEnabled":l.oImageSmoothingEnabled?i.smoothProperty="oImageSmoothingEnabled":l.msImageSmoothingEnabled&&(i.smoothProperty="msImageSmoothingEnabled")}return i.initPlugins(s.__plugins),t.sayHello("Canvas"),i.resize(i.options.width,i.options.height),i}return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(s,r),s.prototype.addSystem=function(){return this},s.prototype.render=function(r,n){if(this.view){var i,a,s,h;n&&(n instanceof e.RenderTexture||n instanceof e.BaseRenderTexture?(i=n,a=arguments[2],s=arguments[3],h=arguments[4]):(i=n.renderTexture,a=n.clear,s=n.transform,h=n.skipUpdateTransform)),this.renderingToScreen=!i,this.emit("prerender");var l=this.resolution;i?((i=i.castToBaseTexture())._canvasRenderTarget||(i._canvasRenderTarget=new t.CanvasRenderTarget(i.width,i.height,i.resolution),i.resource=new e.CanvasResource(i._canvasRenderTarget.canvas),i.valid=!0),this.context=i._canvasRenderTarget.context,this.resolution=i._canvasRenderTarget.resolution):this.context=this.rootContext;var c=this.context;if(this._projTransform=s||null,i||(this._lastObjectRendered=r),!h){var d=r.enableTempParent();r.updateTransform(),r.disableTempParent(d)}if(c.save(),c.setTransform(1,0,0,1,0,0),c.globalAlpha=1,this._activeBlendMode=o.BLEND_MODES.NORMAL,this._outerBlend=!1,c.globalCompositeOperation=this.blendModes[o.BLEND_MODES.NORMAL],void 0!==a?a:this.clearBeforeRender)if(this.renderingToScreen)c.clearRect(0,0,this.width,this.height),this.backgroundAlpha>0&&(c.globalAlpha=this.useContextAlpha?this.backgroundAlpha:1,c.fillStyle=this._backgroundColorString,c.fillRect(0,0,this.width,this.height),c.globalAlpha=1);else{(i=i)._canvasRenderTarget.clear();var u=i.clearColor;u[3]>0&&(c.globalAlpha=this.useContextAlpha?u[3]:1,c.fillStyle=t.hex2string(t.rgb2hex(u)),c.fillRect(0,0,i.realWidth,i.realHeight),c.globalAlpha=1)}var p=this.context;this.context=c,r.renderCanvas(this),this.context=p,c.restore(),this.resolution=l,this._projTransform=null,this.emit("postrender")}},s.prototype.setContextTransform=function(e,t,r){var o=e,n=this._projTransform,i=this.resolution;r=r||i,n&&((o=l).copyFrom(e),o.prepend(n)),t?this.context.setTransform(o.a*r,o.b*r,o.c*r,o.d*r,o.tx*i|0,o.ty*i|0):this.context.setTransform(o.a*r,o.b*r,o.c*r,o.d*r,o.tx*i,o.ty*i)},s.prototype.clear=function(e,t){void 0===e&&(e=this._backgroundColorString),void 0===t&&(t=this.backgroundAlpha);var r=this.context;r.clearRect(0,0,this.width,this.height),e&&(r.globalAlpha=this.useContextAlpha?t:1,r.fillStyle=e,r.fillRect(0,0,this.width,this.height),r.globalAlpha=1)},s.prototype.setBlendMode=function(e,t){var r=e===o.BLEND_MODES.SRC_IN||e===o.BLEND_MODES.SRC_OUT||e===o.BLEND_MODES.DST_IN||e===o.BLEND_MODES.DST_ATOP;!t&&r&&(e=o.BLEND_MODES.NORMAL),this._activeBlendMode!==e&&(this._activeBlendMode=e,this._outerBlend=r,this.context.globalCompositeOperation=this.blendModes[e])},s.prototype.destroy=function(e){r.prototype.destroy.call(this,e),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},s.prototype.resize=function(e,t){r.prototype.resize.call(this,e,t),this.smoothProperty&&(this.rootContext[this.smoothProperty]=n.settings.SCALE_MODE===o.SCALE_MODES.LINEAR)},s.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},s.registerPlugin=function(t,r){e.extensions.add({name:t,type:e.ExtensionType.CanvasRendererPlugin,ref:r})},s.__plugins={},s}(e.AbstractRenderer);e.extensions.handleByMap(e.ExtensionType.CanvasRendererPlugin,c.__plugins);var d={canvas:null,getTintedCanvas:function(e,t){var r=e.texture,o="#"+("00000"+(0|(t=d.roundColor(t))).toString(16)).slice(-6);r.tintCache=r.tintCache||{};var i,a=r.tintCache[o];if(a){if(a.tintId===r._updateID)return r.tintCache[o];i=r.tintCache[o]}else i=n.settings.ADAPTER.createCanvas();if(d.tintMethod(r,t,i),i.tintId=r._updateID,d.convertTintToImage){var s=new Image;s.src=i.toDataURL(),r.tintCache[o]=s}else r.tintCache[o]=i;return i},getTintedPattern:function(e,t){var r="#"+("00000"+(0|(t=d.roundColor(t))).toString(16)).slice(-6);e.patternCache=e.patternCache||{};var o=e.patternCache[r];return o&&o.tintId===e._updateID||(d.canvas||(d.canvas=n.settings.ADAPTER.createCanvas()),d.tintMethod(e,t,d.canvas),(o=d.canvas.getContext("2d").createPattern(d.canvas,"repeat")).tintId=e._updateID,e.patternCache[r]=o),o},tintWithMultiply:function(e,t,r){var o=r.getContext("2d"),n=e._frame.clone(),i=e.baseTexture.resolution;n.x*=i,n.y*=i,n.width*=i,n.height*=i,r.width=Math.ceil(n.width),r.height=Math.ceil(n.height),o.save(),o.fillStyle="#"+("00000"+(0|t).toString(16)).slice(-6),o.fillRect(0,0,n.width,n.height),o.globalCompositeOperation="multiply";var a=e.baseTexture.getDrawableSource();o.drawImage(a,n.x,n.y,n.width,n.height,0,0,n.width,n.height),o.globalCompositeOperation="destination-atop",o.drawImage(a,n.x,n.y,n.width,n.height,0,0,n.width,n.height),o.restore()},tintWithOverlay:function(e,t,r){var o=r.getContext("2d"),n=e._frame.clone(),i=e.baseTexture.resolution;n.x*=i,n.y*=i,n.width*=i,n.height*=i,r.width=Math.ceil(n.width),r.height=Math.ceil(n.height),o.save(),o.globalCompositeOperation="copy",o.fillStyle="#"+("00000"+(0|t).toString(16)).slice(-6),o.fillRect(0,0,n.width,n.height),o.globalCompositeOperation="destination-atop",o.drawImage(e.baseTexture.getDrawableSource(),n.x,n.y,n.width,n.height,0,0,n.width,n.height),o.restore()},tintWithPerPixel:function(e,r,o){var n=o.getContext("2d"),i=e._frame.clone(),a=e.baseTexture.resolution;i.x*=a,i.y*=a,i.width*=a,i.height*=a,o.width=Math.ceil(i.width),o.height=Math.ceil(i.height),n.save(),n.globalCompositeOperation="copy",n.drawImage(e.baseTexture.getDrawableSource(),i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.restore();for(var s=t.hex2rgb(r),h=s[0],l=s[1],c=s[2],d=n.getImageData(0,0,i.width,i.height),u=d.data,p=0;p<u.length;p+=4)u[p+0]*=h,u[p+1]*=l,u[p+2]*=c;n.putImageData(d,0,0)},roundColor:function(e){var r=d.cacheStepsPerColorChannel,o=t.hex2rgb(e);return o[0]=Math.min(255,o[0]/r*r),o[1]=Math.min(255,o[1]/r*r),o[2]=Math.min(255,o[2]/r*r),t.rgb2hex(o)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:h(),tintMethod:null};d.tintMethod=d.canUseMultiply?d.tintWithMultiply:d.tintWithPerPixel;var u=e.Renderer.create;e.Renderer.create=function(e){if(!(e&&e.forceCanvas))try{return u(e)}catch(e){}return new c(e)},e.BaseTexture.prototype.getDrawableSource=function(){var e=this.resource;return e?e.bitmap||e.source:null},e.BaseRenderTexture.prototype._canvasRenderTarget=null,e.Texture.prototype.patternCache=null,e.Texture.prototype.tintCache=null,exports.CanvasRenderer=c,exports.canUseNewCanvasBlendModes=h,exports.canvasUtils=d;
//# sourceMappingURL=canvas-renderer.min.js.map
