/*!
 * @pixi/canvas-renderer - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/canvas-renderer is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
import{CanvasResource as e,extensions as t,ExtensionType as o,AbstractRenderer as r,RenderTexture as i,BaseRenderTexture as n,Renderer as a,BaseTexture as s,Texture as h}from"@pixi/core";import{CanvasRenderTarget as l,hex2string as c,rgb2hex as d,sayHello as u,hex2rgb as p}from"@pixi/utils";import{SHAPES as g,Matrix as v}from"@pixi/math";import{BLEND_MODES as f,SCALE_MODES as m,RENDERER_TYPE as C}from"@pixi/constants";import{settings as T}from"@pixi/settings";var y=function(e,t){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])},y(e,t)};var x=function(){function e(e){this._foundShapes=[],this.renderer=e}return e.prototype.pushMask=function(e){var t=this.renderer,o=e.maskObject||e;t.context.save();var r=this._foundShapes;if(this.recursiveFindShapes(o,r),r.length>0){var i=t.context;i.beginPath();for(var n=0;n<r.length;n++){var a=r[n],s=a.transform.worldTransform;this.renderer.setContextTransform(s),this.renderGraphicsShape(a)}r.length=0,i.clip()}},e.prototype.recursiveFindShapes=function(e,t){e.geometry&&e.geometry.graphicsData&&t.push(e);var o=e.children;if(o)for(var r=0;r<o.length;r++)this.recursiveFindShapes(o[r],t)},e.prototype.renderGraphicsShape=function(e){e.finishPoly();var t=this.renderer.context,o=e.geometry.graphicsData,r=o.length;if(0!==r)for(var i=0;i<r;i++){var n=o[i],a=n.shape;if(a.type===g.POLY){var s=a.points,h=n.holes,l=void 0,c=void 0,d=void 0,u=void 0;t.moveTo(s[0],s[1]);for(var p=1;p<s.length/2;p++)t.lineTo(s[2*p],s[2*p+1]);if(h.length>0){l=0,d=s[0],u=s[1];for(p=2;p+2<s.length;p+=2)l+=(s[p]-d)*(s[p+3]-u)-(s[p+2]-d)*(s[p+1]-u);for(var v=0;v<h.length;v++)if(s=h[v].shape.points){c=0,d=s[0],u=s[1];for(p=2;p+2<s.length;p+=2)c+=(s[p]-d)*(s[p+3]-u)-(s[p+2]-d)*(s[p+1]-u);if(c*l<0){t.moveTo(s[0],s[1]);for(p=2;p<s.length;p+=2)t.lineTo(s[p],s[p+1])}else{t.moveTo(s[s.length-2],s[s.length-1]);for(p=s.length-4;p>=0;p-=2)t.lineTo(s[p],s[p+1])}h[v].shape.closeStroke&&t.closePath()}}s[0]===s[s.length-2]&&s[1]===s[s.length-1]&&t.closePath()}else if(a.type===g.RECT)t.rect(a.x,a.y,a.width,a.height),t.closePath();else if(a.type===g.CIRC)t.arc(a.x,a.y,a.radius,0,2*Math.PI),t.closePath();else if(a.type===g.ELIP){var f=2*a.width,m=2*a.height,C=a.x-f/2,T=a.y-m/2,y=.5522848,x=f/2*y,_=m/2*y,R=C+f,S=T+m,b=C+f/2,O=T+m/2;t.moveTo(C,O),t.bezierCurveTo(C,O-_,b-x,T,b,T),t.bezierCurveTo(b+x,T,R,O-_,R,O),t.bezierCurveTo(R,O+_,b+x,S,b,S),t.bezierCurveTo(b-x,S,C,O+_,C,O),t.closePath()}else if(a.type===g.RREC){var I=a.x,w=a.y,A=a.width,M=a.height,E=a.radius,P=Math.min(A,M)/2;E=E>P?P:E,t.moveTo(I,w+E),t.lineTo(I,w+M-E),t.quadraticCurveTo(I,w+M,I+E,w+M),t.lineTo(I+A-E,w+M),t.quadraticCurveTo(I+A,w+M,I+A,w+M-E),t.lineTo(I+A,w+E),t.quadraticCurveTo(I+A,w,I+A-E,w),t.lineTo(I+E,w),t.quadraticCurveTo(I,w,I,w+E),t.closePath()}}},e.prototype.popMask=function(e){e.context.restore(),e.invalidateBlendMode()},e.prototype.destroy=function(){},e}();function _(e){var t=T.ADAPTER.createCanvas(6,1),o=t.getContext("2d");return o.fillStyle=e,o.fillRect(0,0,6,1),t}function R(){if("undefined"==typeof document)return!1;var e=_("#ff00ff"),t=_("#ffff00"),o=T.ADAPTER.createCanvas(6,1).getContext("2d");o.globalCompositeOperation="multiply",o.drawImage(e,0,0),o.drawImage(t,2,0);var r=o.getImageData(2,0,1,1);if(!r)return!1;var i=r.data;return 255===i[0]&&0===i[1]&&0===i[2]}var S=new v,b=function(r){function a(e){var t,o=r.call(this,C.CANVAS,e)||this;if(o.refresh=!0,o.maskManager=new x(o),o.smoothProperty="imageSmoothingEnabled",o.blendModes=(void 0===t&&(t=[]),R()?(t[f.NORMAL]="source-over",t[f.ADD]="lighter",t[f.MULTIPLY]="multiply",t[f.SCREEN]="screen",t[f.OVERLAY]="overlay",t[f.DARKEN]="darken",t[f.LIGHTEN]="lighten",t[f.COLOR_DODGE]="color-dodge",t[f.COLOR_BURN]="color-burn",t[f.HARD_LIGHT]="hard-light",t[f.SOFT_LIGHT]="soft-light",t[f.DIFFERENCE]="difference",t[f.EXCLUSION]="exclusion",t[f.HUE]="hue",t[f.SATURATION]="saturation",t[f.COLOR]="color",t[f.LUMINOSITY]="luminosity"):(t[f.NORMAL]="source-over",t[f.ADD]="lighter",t[f.MULTIPLY]="source-over",t[f.SCREEN]="source-over",t[f.OVERLAY]="source-over",t[f.DARKEN]="source-over",t[f.LIGHTEN]="source-over",t[f.COLOR_DODGE]="source-over",t[f.COLOR_BURN]="source-over",t[f.HARD_LIGHT]="source-over",t[f.SOFT_LIGHT]="source-over",t[f.DIFFERENCE]="source-over",t[f.EXCLUSION]="source-over",t[f.HUE]="source-over",t[f.SATURATION]="source-over",t[f.COLOR]="source-over",t[f.LUMINOSITY]="source-over"),t[f.NORMAL_NPM]=t[f.NORMAL],t[f.ADD_NPM]=t[f.ADD],t[f.SCREEN_NPM]=t[f.SCREEN],t[f.SRC_IN]="source-in",t[f.SRC_OUT]="source-out",t[f.SRC_ATOP]="source-atop",t[f.DST_OVER]="destination-over",t[f.DST_IN]="destination-in",t[f.DST_OUT]="destination-out",t[f.DST_ATOP]="destination-atop",t[f.XOR]="xor",t[f.SUBTRACT]="source-over",t),o.renderingToScreen=!1,o._activeBlendMode=null,o._projTransform=null,o._outerBlend=!1,o.rootContext=o.view.getContext("2d",{alpha:o.useContextAlpha}),o.context=o.rootContext,!o.rootContext.imageSmoothingEnabled){var i=o.rootContext;i.webkitImageSmoothingEnabled?o.smoothProperty="webkitImageSmoothingEnabled":i.mozImageSmoothingEnabled?o.smoothProperty="mozImageSmoothingEnabled":i.oImageSmoothingEnabled?o.smoothProperty="oImageSmoothingEnabled":i.msImageSmoothingEnabled&&(o.smoothProperty="msImageSmoothingEnabled")}return o.initPlugins(a.__plugins),u("Canvas"),o.resize(o.options.width,o.options.height),o}return function(e,t){function o(){this.constructor=e}y(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}(a,r),a.prototype.addSystem=function(){return this},a.prototype.render=function(t,o){if(this.view){var r,a,s,h;o&&(o instanceof i||o instanceof n?(r=o,a=arguments[2],s=arguments[3],h=arguments[4]):(r=o.renderTexture,a=o.clear,s=o.transform,h=o.skipUpdateTransform)),this.renderingToScreen=!r,this.emit("prerender");var u=this.resolution;r?((r=r.castToBaseTexture())._canvasRenderTarget||(r._canvasRenderTarget=new l(r.width,r.height,r.resolution),r.resource=new e(r._canvasRenderTarget.canvas),r.valid=!0),this.context=r._canvasRenderTarget.context,this.resolution=r._canvasRenderTarget.resolution):this.context=this.rootContext;var p=this.context;if(this._projTransform=s||null,r||(this._lastObjectRendered=t),!h){var g=t.enableTempParent();t.updateTransform(),t.disableTempParent(g)}if(p.save(),p.setTransform(1,0,0,1,0,0),p.globalAlpha=1,this._activeBlendMode=f.NORMAL,this._outerBlend=!1,p.globalCompositeOperation=this.blendModes[f.NORMAL],void 0!==a?a:this.clearBeforeRender)if(this.renderingToScreen)p.clearRect(0,0,this.width,this.height),this.backgroundAlpha>0&&(p.globalAlpha=this.useContextAlpha?this.backgroundAlpha:1,p.fillStyle=this._backgroundColorString,p.fillRect(0,0,this.width,this.height),p.globalAlpha=1);else{(r=r)._canvasRenderTarget.clear();var v=r.clearColor;v[3]>0&&(p.globalAlpha=this.useContextAlpha?v[3]:1,p.fillStyle=c(d(v)),p.fillRect(0,0,r.realWidth,r.realHeight),p.globalAlpha=1)}var m=this.context;this.context=p,t.renderCanvas(this),this.context=m,p.restore(),this.resolution=u,this._projTransform=null,this.emit("postrender")}},a.prototype.setContextTransform=function(e,t,o){var r=e,i=this._projTransform,n=this.resolution;o=o||n,i&&((r=S).copyFrom(e),r.prepend(i)),t?this.context.setTransform(r.a*o,r.b*o,r.c*o,r.d*o,r.tx*n|0,r.ty*n|0):this.context.setTransform(r.a*o,r.b*o,r.c*o,r.d*o,r.tx*n,r.ty*n)},a.prototype.clear=function(e,t){void 0===e&&(e=this._backgroundColorString),void 0===t&&(t=this.backgroundAlpha);var o=this.context;o.clearRect(0,0,this.width,this.height),e&&(o.globalAlpha=this.useContextAlpha?t:1,o.fillStyle=e,o.fillRect(0,0,this.width,this.height),o.globalAlpha=1)},a.prototype.setBlendMode=function(e,t){var o=e===f.SRC_IN||e===f.SRC_OUT||e===f.DST_IN||e===f.DST_ATOP;!t&&o&&(e=f.NORMAL),this._activeBlendMode!==e&&(this._activeBlendMode=e,this._outerBlend=o,this.context.globalCompositeOperation=this.blendModes[e])},a.prototype.destroy=function(e){r.prototype.destroy.call(this,e),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},a.prototype.resize=function(e,t){r.prototype.resize.call(this,e,t),this.smoothProperty&&(this.rootContext[this.smoothProperty]=T.SCALE_MODE===m.LINEAR)},a.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},a.registerPlugin=function(e,r){t.add({name:e,type:o.CanvasRendererPlugin,ref:r})},a.__plugins={},a}(r);t.handleByMap(o.CanvasRendererPlugin,b.__plugins);var O={canvas:null,getTintedCanvas:function(e,t){var o=e.texture,r="#"+("00000"+(0|(t=O.roundColor(t))).toString(16)).slice(-6);o.tintCache=o.tintCache||{};var i,n=o.tintCache[r];if(n){if(n.tintId===o._updateID)return o.tintCache[r];i=o.tintCache[r]}else i=T.ADAPTER.createCanvas();if(O.tintMethod(o,t,i),i.tintId=o._updateID,O.convertTintToImage){var a=new Image;a.src=i.toDataURL(),o.tintCache[r]=a}else o.tintCache[r]=i;return i},getTintedPattern:function(e,t){var o="#"+("00000"+(0|(t=O.roundColor(t))).toString(16)).slice(-6);e.patternCache=e.patternCache||{};var r=e.patternCache[o];return r&&r.tintId===e._updateID||(O.canvas||(O.canvas=T.ADAPTER.createCanvas()),O.tintMethod(e,t,O.canvas),(r=O.canvas.getContext("2d").createPattern(O.canvas,"repeat")).tintId=e._updateID,e.patternCache[o]=r),r},tintWithMultiply:function(e,t,o){var r=o.getContext("2d"),i=e._frame.clone(),n=e.baseTexture.resolution;i.x*=n,i.y*=n,i.width*=n,i.height*=n,o.width=Math.ceil(i.width),o.height=Math.ceil(i.height),r.save(),r.fillStyle="#"+("00000"+(0|t).toString(16)).slice(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="multiply";var a=e.baseTexture.getDrawableSource();r.drawImage(a,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(a,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.restore()},tintWithOverlay:function(e,t,o){var r=o.getContext("2d"),i=e._frame.clone(),n=e.baseTexture.resolution;i.x*=n,i.y*=n,i.width*=n,i.height*=n,o.width=Math.ceil(i.width),o.height=Math.ceil(i.height),r.save(),r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(0|t).toString(16)).slice(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.getDrawableSource(),i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.restore()},tintWithPerPixel:function(e,t,o){var r=o.getContext("2d"),i=e._frame.clone(),n=e.baseTexture.resolution;i.x*=n,i.y*=n,i.width*=n,i.height*=n,o.width=Math.ceil(i.width),o.height=Math.ceil(i.height),r.save(),r.globalCompositeOperation="copy",r.drawImage(e.baseTexture.getDrawableSource(),i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.restore();for(var a=p(t),s=a[0],h=a[1],l=a[2],c=r.getImageData(0,0,i.width,i.height),d=c.data,u=0;u<d.length;u+=4)d[u+0]*=s,d[u+1]*=h,d[u+2]*=l;r.putImageData(c,0,0)},roundColor:function(e){var t=O.cacheStepsPerColorChannel,o=p(e);return o[0]=Math.min(255,o[0]/t*t),o[1]=Math.min(255,o[1]/t*t),o[2]=Math.min(255,o[2]/t*t),d(o)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:R(),tintMethod:null};O.tintMethod=O.canUseMultiply?O.tintWithMultiply:O.tintWithPerPixel;var I=a.create;a.create=function(e){if(!(e&&e.forceCanvas))try{return I(e)}catch(e){}return new b(e)},s.prototype.getDrawableSource=function(){var e=this.resource;return e?e.bitmap||e.source:null},n.prototype._canvasRenderTarget=null,h.prototype.patternCache=null,h.prototype.tintCache=null;export{b as CanvasRenderer,R as canUseNewCanvasBlendModes,O as canvasUtils};
//# sourceMappingURL=canvas-renderer.min.mjs.map
